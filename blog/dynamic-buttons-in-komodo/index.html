<!DOCTYPE html><html><head prefix="og: http://ogp.me/ns# profile: http://ogp.me/ns/profile# article: http://ogp.me/ns/article#"><meta content="IE-edge" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" /><meta content="#BA488A" name="theme-color" /><title>Creating a dynamic toolbar button for Komodo X</title><meta content="I'm finding side toolbar very useful for me. More over, you can write your own tools for it. So, how do you do that?" name="description" /><meta content="Creating a dynamic toolbar button for Komodo X" property="og:title" /><meta content="article" property="og:type" /><meta content="I'm finding side toolbar very useful for me. More over, you can write your own tools for it. So, how do you do that?" property="og:description" /><meta content="Defman.me" property="og:site_name" /><meta content="//defman.me/blog/dynamic-buttons-in-komodo/" property="og:url" /><meta content="Sergey Kislyakov" property="article:author" /><meta content="komodo" property="article:tag" /><meta content="userscripts" property="article:tag" /><meta content="javascript" property="article:tag" /><link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Slab" rel="stylesheet" /><link href="/assets/stylesheets/font-awesome.css?1476619637" rel="stylesheet" /><link href="/assets/stylesheets/index.css?1476619637" rel="stylesheet" /><link href="/assets/stylesheets/highlight/styles.css?1476619637" rel="stylesheet" /><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-52157854-2', 'auto');
ga('send', 'pageview');</script></head><body><header><div class="overlay"><div class="logo"><a href="/">Defman.me</a></div><nav><a href="/blog" id="blog">BLOG</a><a href="/projects" id="projects">PROJECTS</a><a href="/schemes" id="schemes">SCHEMES</a></nav></div></header><div class="overlay"><main><div class="container article page" id="201608312042-dynamic-buttons-in-komodo"><span class="title">Creating a dynamic toolbar button for Komodo X</span><div class="infobar"><span class="readtime"><i class="fa fa-clock-o"></i> 3 min read</span><span class="timestamp"><i class="fa fa-calendar"></i> August 31, 2016</span><span class="tags"><i class="fa fa-tags"></i> komodo, userscripts, javascript</span></div><div class="content"><p>What are those &ldquo;dynamic buttons&rdquo;? This is a new thing in Komodo <strong>IDE</strong> X.
Depending on different statements, these buttons will appear and disappear.
If you&rsquo;re editing a markdown file, a markdown dynamic button will appear in
side toolbar. I hope you get the idea.</p>

<p>A button could do a lot of things. You can run shell commands or do anything
else that you can do using Komodo&rsquo;s SDK. I&rsquo;m going to write a simple button that
will show a notify contains path of current project. Why? With this idea, I&rsquo;ll
cover things I want to describe:</p>

<ol>
<li>Statements whenever a button should appear.</li>
<li>How you can access Komodo&rsquo;s SDK.</li>
</ol>

<p>Let&rsquo;s get started!</p>

<h2>Creating an userscript</h2>

<p>This step is pretty easy - open right pane, right click - Add - New Userscript.
Name it somehow and close the popup. Then right click on the userscript -
Edit Userscript.</p>

<h1>The code!</h1>

<p>The first thing we&rsquo;ll do is create a local scope:</p>
<pre class="highlight javascript"><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">})();</span>
</code></pre>

<p>This helps us to avoid any conflicts with global variables. The rest of the
code will be at the <code class="prettyprint">...</code> place.</p>

<p>Then, require the module:</p>

<h2>Requires</h2>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'ko/dynamic-button'</span><span class="p">);</span>
</code></pre>

<p>We&rsquo;ll use <code class="prettyprint">db</code> variable for registering our button.</p>

<p>Then, require a legacy module for accessing projects:</p>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">koPart</span> <span class="o">=</span> <span class="nx">Cc</span><span class="p">[</span><span class="s2">"@activestate.com/koPartService;1"</span><span class="p">].</span><span class="nx">getService</span><span class="p">(</span><span class="nx">Ci</span><span class="p">.</span><span class="nx">koIPartService</span><span class="p">);</span>
</code></pre>

<p>We&rsquo;ll use it to check if there&rsquo;s a project opened and then get the project path.
As I said, our button will show a notification. So we need the notification
module!</p>
<pre class="highlight javascript"><code><span class="nx">require</span><span class="p">(</span><span class="s1">'notify/categories'</span><span class="p">).</span><span class="nx">register</span><span class="p">(</span><span class="s1">'my_dynamic_button'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">label</span><span class="p">:</span> <span class="s2">"Dynamic button"</span>
<span class="p">});</span>
</code></pre>

<p>We&rsquo;ll register a category for notifications, so we can use it in the future.</p>

<p>Now, require an actual API to send notifications:</p>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">notify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'notify'</span><span class="p">);</span>
</code></pre>

<p>We&rsquo;re done with requiring things. Let&rsquo;s get into the logic!</p>

<h2>The logic</h2>

<p>First, we&rsquo;ll create a function that will return current project path or null.</p>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">project</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">koPart</span><span class="p">.</span><span class="nx">currentProject</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// check if a project is opened</span>
        <span class="k">return</span> <span class="nx">koPart</span><span class="p">.</span><span class="nx">currentProject</span><span class="p">.</span><span class="nx">liveDirectory</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>

<p>Then, we register our button:</p>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">register</span><span class="p">({</span>
    <span class="na">label</span><span class="p">:</span> <span class="s2">"My button"</span><span class="p">,</span>
    <span class="na">tooltip</span><span class="p">:</span> <span class="s2">"Tooltip for my button"</span><span class="p">,</span>
    <span class="na">icon</span><span class="p">:</span> <span class="s2">"cloud"</span><span class="p">,</span> <span class="c1">// a nice cloud</span>
    <span class="na">events</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"current_view_changed"</span><span class="p">,</span>
        <span class="s2">"current_place_opened"</span><span class="p">,</span>
        <span class="s2">"file_saved"</span>
    <span class="p">],</span> <span class="c1">// the list of events that will fire isEnabled function</span>
       <span class="c1">// note it's optional, if you don't specify this varialbe the list will be the same</span>
    <span class="na">isEnabled</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// our checking function, true enables it, false disables it</span>
        <span class="k">return</span> <span class="nx">project</span><span class="p">()</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">command</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">notify</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="err">`</span><span class="na">Button</span><span class="p">:</span> <span class="na">path</span><span class="p">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">project</span><span class="p">()}</span><span class="err">`</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">priority</span><span class="p">:</span> <span class="s2">"info"</span><span class="p">,</span>
            <span class="na">category</span><span class="p">:</span> <span class="s2">"my_dynamic_button"</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>

<p>And&hellip; done! Now run your userscript. If you don&rsquo;t see a cloud icon in your
side toolbar, you didn&rsquo;t open a project then. That&rsquo;s our check right there!</p>

<p>When you click on it, a notification will appear (probably in the top of your
editor, inside Commando thing).</p>

<p>A more complicated button with a menu will be reviewed very soon! I just wanted
to give some basics about that because it&rsquo;s not documented anywhere.</p>

<h1>The final code</h1>
<pre class="highlight javascript"><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'ko/dynamic-button'</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">koPart</span> <span class="o">=</span> <span class="nx">Cc</span><span class="p">[</span><span class="s2">"@activestate.com/koPartService;1"</span><span class="p">].</span><span class="nx">getService</span><span class="p">(</span><span class="nx">Ci</span><span class="p">.</span><span class="nx">koIPartService</span><span class="p">);</span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">'notify/categories'</span><span class="p">).</span><span class="nx">register</span><span class="p">(</span><span class="s1">'my_dynamic_button'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">label</span><span class="p">:</span> <span class="s2">"Dynamic button"</span>
    <span class="p">});</span>
    <span class="kr">const</span> <span class="nx">notify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'notify'</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">project</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">koPart</span><span class="p">.</span><span class="nx">currentProject</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">koPart</span><span class="p">.</span><span class="nx">currentProject</span><span class="p">.</span><span class="nx">liveDirectory</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">register</span><span class="p">({</span>
        <span class="na">label</span><span class="p">:</span> <span class="s2">"My button"</span><span class="p">,</span>
        <span class="na">tooltip</span><span class="p">:</span> <span class="s2">"Tooltip for my button"</span><span class="p">,</span>
        <span class="na">icon</span><span class="p">:</span> <span class="s2">"cloud"</span><span class="p">,</span> <span class="c1">// a nice cloud</span>
        <span class="na">events</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"current_view_changed"</span><span class="p">,</span>
            <span class="s2">"current_place_opened"</span><span class="p">,</span>
            <span class="s2">"file_saved"</span>
        <span class="p">],</span> <span class="c1">// the list of events that will fire isEnabled function</span>
           <span class="c1">// note it's optional, if you don't specify this varialbe the list will be the same</span>
        <span class="na">isEnabled</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// our checking function, true enables it, false disables it</span>
            <span class="k">return</span> <span class="nx">project</span><span class="p">()</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="na">command</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">notify</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="err">`</span><span class="na">Button</span><span class="p">:</span> <span class="na">path</span><span class="p">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">project</span><span class="p">()}</span><span class="err">`</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">priority</span><span class="p">:</span> <span class="s2">"info"</span><span class="p">,</span>
                <span class="na">category</span><span class="p">:</span> <span class="s2">"my_dynamic_button"</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">})();</span>
</code></pre>

<h3>Post-Scriptum</h3>

<p>Thanks a lot to Carey Hoffman from ActiveState for giving me actual examples
of code! (Those were private, so don&rsquo;t even bother! :P)</p>

<p>However, there is <a href="https://github.com/Komodo/KomodoEdit/blob/master/src/modules/lintresults/content/lintresults.js">an open-source example!</a> (Thanks to Nathan Rijksen!)</p>
</div></div><div class="container comments"><div class="comments"><div id="comments_loading">Comments are loading</div><div id="disqus_thread"></div><script>var disqus_config = function () {
    this.page.url = "http://defman.me/blog/dynamic-buttons-in-komodo/";
    this.page.identifier = "201608312042-dynamic-buttons-in-komodo";
};
var loadDisqusComments = (function() {
    (e=document.getElementById('comments_loading')).parentNode.removeChild(e);
    var d = document, s = d.createElement('script');

    s.src = '//defman.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
});</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a></noscript><script src="/assets/javascripts/lazyload.js?1476619637"></script></div></div></main><footer><div class="copyright"><a href="//github.com/Defman21/defman.me">defman.me &copy; 2016</a></div></footer></div><script src="/assets/javascripts/jquery.js?1476619637"></script><script src="/assets/javascripts/main.js?1476619637"></script></body></html>